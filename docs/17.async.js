(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"/sM5":function(e,t,a){"use strict";var l=a("TqRt"),s=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var i=l(a("2/Rp"));a("P2fV");var d=l(a("NJEC"));a("/zsF");var r=l(a("PArb"));a("miYZ");var n=l(a("tsqr")),o=l(a("MVZn"));a("2qtc");var m=l(a("kLXV"));a("giR+");var u=l(a("fyUT")),f=l(a("pVnL"));a("5NDa");var c=l(a("5rEg"));a("Pwec");var h=l(a("CtXQ")),p=l(a("o0o1")),g=l(a("yXPU"));a("y8nQ");var b,M,E,v,y,V,I=l(a("Vl3Y")),_=s(a("q1tI")),k=l(a("/L/i")),x=a("LLXN"),w=a("Hg0r"),P=a("+n12"),C=a("Yfch"),R=a("03io"),S=l(a("Mb+H")),F=(b=I.default.create(),b((E=class extends _.PureComponent{constructor(){var e;super(...arguments),e=this,this.handleOk=(()=>{var e=this.props,t=e.form,a=e.handleSave;t.validateFieldsAndScroll((e,t)=>{e||a(t)})}),this.handleExistRole=function(){var t=(0,g.default)(p.default.mark(function t(a,l,s){var i,d,r,n,o,m,u;return p.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i=e.props,d=i.editInfo,r=i.mode,n={role_name:l},r||(n.id=d.id),t.next=5,(0,R.existRole)(n);case 5:o=t.sent,m=o.code,u=o.data,!m&&u.exist&&s((0,x.formatMessage)({id:"validation.name.existed"})),s();case 10:case"end":return t.stop()}},t)}));return function(e,a,l){return t.apply(this,arguments)}}()}render(){var e=this.props,t=e.form.getFieldDecorator,a=e.handleModalVisible,l=e.modalVisible,s=e.mode,i=e.editInfo,d={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:14}}};return _.default.createElement(m.default,{destroyOnClose:!0,title:s?_.default.createElement("span",null,_.default.createElement(h.default,{type:"plus"})," ",_.default.createElement(x.FormattedMessage,{id:"system.role.modal.add"})):_.default.createElement("span",null,_.default.createElement(h.default,{type:"edit"})," ",_.default.createElement(x.FormattedMessage,{id:"system.role.modal.edit"})),visible:l,onOk:this.handleOk,onCancel:a},_.default.createElement(I.default,null,_.default.createElement(I.default.Item,(0,f.default)({},d,{label:(0,x.formatMessage)({id:"label.name"})}),t("role_name",{initialValue:s?"":i.role_name,validateFirst:!0,rules:[{required:!0,whitespace:!1,message:(0,x.formatMessage)({id:"validation.name.required"})},{pattern:C.regTitle,message:(0,x.formatMessage)({id:"validation.name"})},{validator:this.handleExistRole}]})(_.default.createElement(c.default,null))),_.default.createElement(I.default.Item,(0,f.default)({},d,{label:(0,x.formatMessage)({id:"label.sort"})}),t("sort_no",{initialValue:s?"":i.sort_no})(_.default.createElement(u.default,{min:0,step:1,style:{width:"100%"}}))),_.default.createElement(I.default.Item,(0,f.default)({},d,{label:(0,x.formatMessage)({id:"label.desc"})}),t("role_desc",{initialValue:s?"":i.role_desc})(_.default.createElement(c.default.TextArea,{maxLength:50})))))}},M=E))||M),L=(v=(0,w.connect)(e=>{var t=e.role,a=e.loading;return{data:t.data,permission:t.permission,loading:a.effects["role/getList"]}}),v((V=class extends _.PureComponent{constructor(){super(...arguments),this.state={sortedInfo:{},filteredInfo:{},modalVisible:!1,modalMode:!0,editInfo:{},permissionVisible:!1},this.bindRef=(e=>{this.child=e}),this.initRoleDropList=(()=>{var e=this.props.dispatch;e({type:"role/getRoleDropList"})}),this.handleChange=((e,t)=>{this.setState({sortedInfo:(0,o.default)({},e),filteredInfo:(0,o.default)({},t)})}),this.handleDelete=(e=>{var t=this.props.dispatch;t({type:"role/delete",payload:{id:e},callback:()=>{n.default.success((0,x.formatMessage)({id:"msg.deleted"}))}})}),this.handleModalVisible=(()=>{this.setState({modalVisible:!this.state.modalVisible})}),this.handleModalOpen=(e=>{this.setState({modalMode:e,modalVisible:!this.state.modalVisible})}),this.handleEdit=(e=>{this.setState({editInfo:e},()=>{this.handleModalOpen(!1)})}),this.handleSave=(e=>{var t=this.props.dispatch,a=this.state,l=a.modalMode,s=a.editInfo;t({type:l?"role/create":"role/update",payload:l?e:Object.assign(e,{id:s.id}),callback:()=>{this.setState({modalVisible:!1}),n.default.success(l?(0,x.formatMessage)({id:"msg.created"}):(0,x.formatMessage)({id:"msg.updated"}))}})}),this.handlePermissionModalVisiable=((e,t)=>{this.setState({assignRoleId:e||"",permissionVisible:!this.state.permissionVisible},()=>{t&&t()})}),this.handleAssignPermissions=(e=>{var t=this.props.dispatch;t({type:"role/getPermission",payload:{id:e},callback:()=>{this.handlePermissionModalVisiable(e,()=>{this.child.setCheckedKeys(this.props.permission,[])})}})}),this.handleSavePermission=(e=>{var t=this.props.dispatch;t({type:"role/savePermission",payload:{id:this.state.assignRoleId,resource_list:e},callback:()=>{n.default.success((0,x.formatMessage)({id:"msg.saved"})),this.handlePermissionModalVisiable()}})})}componentDidMount(){this.initRoleDropList()}render(){var e=this.props,t=e.data,a=e.loading,l=this.state.sortedInfo,s=[{title:(0,x.formatMessage)({id:"label.name"}),key:"role_name",dataIndex:"role_name",fixed:!0,width:260},{title:(0,x.formatMessage)({id:"label.desc"}),key:"role_desc",dataIndex:"role_desc",width:300},{title:(0,x.formatMessage)({id:"label.sort"}),key:"sort_no",dataIndex:"sort_no",sorter:!0,sortOrder:"sort_no"===l.columnKey&&l.order,width:100},{align:"center",title:(0,x.formatMessage)({id:"label.create-time"}),key:"create_time",dataIndex:"create_time",sorter:!0,sortOrder:"create_time"===l.columnKey&&l.order,render:e=>_.default.createElement("span",null,(0,P.formatTime)(e))},{title:(0,x.formatMessage)({id:"label.operation"}),key:"operation",fixed:"right",width:200,render:(e,t)=>_.default.createElement("div",null,t.is_system?null:_.default.createElement("span",null,_.default.createElement("a",{onClick:()=>this.handleAssignPermissions(t.id)},_.default.createElement(h.default,{type:"safety"})," ",_.default.createElement(x.FormattedMessage,{id:"label.permissions"})),_.default.createElement(r.default,{type:"vertical"}),_.default.createElement("a",{onClick:()=>this.handleEdit(t)},_.default.createElement(h.default,{type:"edit"})," ",_.default.createElement(x.FormattedMessage,{id:"label.edit"})),_.default.createElement(r.default,{type:"vertical"}),_.default.createElement(d.default,{placement:"topRight",icon:_.default.createElement(h.default,{type:"question-circle",className:"danger"}),okText:(0,x.formatMessage)({id:"button.yes"}),cancelText:(0,x.formatMessage)({id:"button.no"}),title:(0,x.formatMessage)({id:"system.role.delete.prompt"}),onConfirm:()=>this.handleDelete(t.id)},_.default.createElement("a",null,_.default.createElement(h.default,{type:"delete"})," ",_.default.createElement(x.FormattedMessage,{id:"label.delete"})))))}],n=_.default.createElement(_.default.Fragment,null,_.default.createElement(i.default,{type:"primary",icon:"plus",onClick:()=>this.handleModalOpen(!0)},_.default.createElement(x.FormattedMessage,{id:"button.add"}))),o={mode:this.state.modalMode,editInfo:this.state.editInfo,modalVisible:this.state.modalVisible,handleModalVisible:this.handleModalVisible,handleSave:this.handleSave};return _.default.createElement(_.Fragment,null,_.default.createElement(k.default,{loading:a,url:"role/getList",data:t,columns:s,buttons:n,rowKey:"id",onChange:this.handleChange},_.default.createElement(k.default.QueryItem,{label:(0,x.formatMessage)({id:"system.role"}),name:"role_name"},_.default.createElement(c.default,{placeholder:(0,x.formatMessage)({id:"placeholder.input"})}))),_.default.createElement(F,o),_.default.createElement(S.default,{modalVisible:this.state.permissionVisible,handleModalVisible:this.handlePermissionModalVisiable,triggerRef:this.bindRef,handleSave:this.handleSavePermission}))}},y=V))||y),O=L;t.default=O}}]);