(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{fmXB:function(e,t,a){"use strict";var l=a("TqRt"),s=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var d=l(a("2/Rp"));a("P2fV");var i=l(a("NJEC"));a("/zsF");var r=l(a("PArb"));a("+BJd");var n=l(a("mr32"));a("miYZ");var o=l(a("tsqr")),u=l(a("MVZn"));a("2qtc");var m=l(a("kLXV"));a("OaEy");var f=l(a("2fM7"));a("7Kak");var c=l(a("9yH6")),h=l(a("pVnL"));a("5NDa");var p=l(a("5rEg"));a("Pwec");var g=l(a("CtXQ")),b=l(a("o0o1")),E=l(a("yXPU"));a("y8nQ");var M,v,y,x,k,V,I=l(a("Vl3Y")),w=s(a("q1tI")),F=l(a("/L/i")),C=a("LLXN"),_=a("Hg0r"),P=a("+n12"),S=a("Yfch"),O=a("k9Yu"),q=l(a("Mb+H")),L=(M=I.default.create(),M((y=class extends w.PureComponent{constructor(){var e;super(...arguments),e=this,this.handleOk=(()=>{var e=this.props,t=e.form,a=e.handleSave;t.validateFieldsAndScroll((e,t)=>{e||a(t)})}),this.handleExistAccount=function(){var t=(0,E.default)(b.default.mark(function t(a,l,s){var d,i,r,n;return b.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(d=e.props.mode,!d){t.next=8;break}return t.next=4,(0,O.existAccount)({user_name:l});case 4:i=t.sent,r=i.code,n=i.data,!r&&n.exist&&s((0,C.formatMessage)({id:"validation.account.existed"}));case 8:s();case 9:case"end":return t.stop()}},t)}));return function(e,a,l){return t.apply(this,arguments)}}(),this.handleExistMobile=function(){var t=(0,E.default)(b.default.mark(function t(a,l,s){var d,i,r,n,o,u,m;return b.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return d=e.props,i=d.editInfo,r=d.mode,n={mobile:l},r||(n.id=i.id),t.next=5,(0,O.existMobile)(n);case 5:o=t.sent,u=o.code,m=o.data,!u&&m.exist&&s((0,C.formatMessage)({id:"validation.mobile.existed"})),s();case 10:case"end":return t.stop()}},t)}));return function(e,a,l){return t.apply(this,arguments)}}()}render(){var e=this.props,t=e.form.getFieldDecorator,a=e.handleModalVisible,l=e.modalVisible,s=e.roleList,d=e.mode,i=e.editInfo,r={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:14}}};return w.default.createElement(m.default,{destroyOnClose:!0,title:d?w.default.createElement("span",null,w.default.createElement(g.default,{type:"user-plus"})," ",w.default.createElement(C.FormattedMessage,{id:"system.user.modal.add"})):w.default.createElement("span",null,w.default.createElement(g.default,{type:"user-edit"})," ",w.default.createElement(C.FormattedMessage,{id:"system.user.modal.edit"})),visible:l,onOk:this.handleOk,onCancel:a},w.default.createElement(I.default,null,w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.account"})}),t("user_name",{initialValue:d?"":i.user_name,validateFirst:!0,rules:[{required:!0,whitespace:!1,message:(0,C.formatMessage)({id:"validation.account.required"})},{pattern:S.regAccount,message:(0,C.formatMessage)({id:"validation.account"})},{validator:this.handleExistAccount}]})(w.default.createElement(p.default,{disabled:!d}))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.name-cn"})}),t("name_cn",{initialValue:d?"":i.name_cn,rules:[{required:!0,whitespace:!1,message:(0,C.formatMessage)({id:"validation.name-cn.required"})},{max:50,min:1,pattern:S.regNameCn,message:(0,C.formatMessage)({id:"validation.name-cn"})}]})(w.default.createElement(p.default,null))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.name-en"})}),t("name_en",{initialValue:d?"":i.name_en,rules:[{whitespace:!0,message:(0,C.formatMessage)({id:"validation.name-en.required"})},{max:50,min:1,pattern:S.regNameEn,message:(0,C.formatMessage)({id:"validation.name-en"})}]})(w.default.createElement(p.default,null))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.sex"})}),t("sex",{initialValue:d?"":i.sex,rules:[{required:!0,message:(0,C.formatMessage)({id:"validation.sex.required"})}]})(w.default.createElement(c.default.Group,null,w.default.createElement(c.default,{value:1},w.default.createElement(C.FormattedMessage,{id:"label.sex.male"})),w.default.createElement(c.default,{value:2},w.default.createElement(C.FormattedMessage,{id:"label.sex.female"}))))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.role"})}),t("role",{initialValue:d?[]:i.role.map(e=>e.id),rules:[{required:!0,message:(0,C.formatMessage)({id:"validation.role.required"})}]})(w.default.createElement(f.default,{mode:"multiple"},s.map(e=>w.default.createElement(f.default.Option,{key:e.id,value:e.id},e.role_name))))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.mobile"})}),t("mobile",{initialValue:d?"":i.mobile,validateFirst:!0,rules:[{required:!0,message:(0,C.formatMessage)({id:"validation.mobile.required"})},{pattern:S.regPhone,message:(0,C.formatMessage)({id:"validation.mobile"})},{validator:this.handleExistMobile}]})(w.default.createElement(p.default,null))),w.default.createElement(I.default.Item,(0,h.default)({},r,{label:(0,C.formatMessage)({id:"label.email"})}),t("mail",{initialValue:d?"":i.mail,rules:[{type:"email",message:(0,C.formatMessage)({id:"validation.email"})}]})(w.default.createElement(p.default,null)))))}},v=y))||v),R=(x=(0,_.connect)(e=>{var t=e.user,a=e.loading;return{data:t.data,roleList:t.roleList,permission:t.permission,loading:a.effects["user/getList"]}}),x((V=class extends w.PureComponent{constructor(){super(...arguments),this.state={sortedInfo:{},filteredInfo:{},modalVisible:!1,modalMode:!0,editInfo:{},permissionVisible:!1},this.bindRef=(e=>{this.child=e}),this.initRoleDropList=(()=>{var e=this.props.dispatch;e({type:"user/getRoleDropList"})}),this.handleChange=((e,t)=>{this.setState({sortedInfo:(0,u.default)({},e),filteredInfo:(0,u.default)({},t)})}),this.handleDelete=(e=>{var t=this.props.dispatch;t({type:"user/delete",payload:{id:e},callback:()=>{o.default.success((0,C.formatMessage)({id:"msg.deleted"}))}})}),this.handleChangeState=((e,t)=>{var a=this.props.dispatch;a({type:"user/updateState",payload:{id:e,status:t?0:1},callback:()=>{o.default.success(t?(0,C.formatMessage)({id:"msg.enabled"}):(0,C.formatMessage)({id:"msg.disabled"}))}})}),this.handleModalVisible=(()=>{this.setState({modalVisible:!this.state.modalVisible})}),this.handleModalOpen=(e=>{this.setState({modalMode:e,modalVisible:!this.state.modalVisible})}),this.handleEdit=(e=>{this.setState({editInfo:e},()=>{this.handleModalOpen(!1)})}),this.handleSave=(e=>{var t=this.props.dispatch,a=this.state,l=a.modalMode,s=a.editInfo;t({type:l?"user/create":"user/update",payload:l?e:Object.assign(e,{id:s.id}),callback:()=>{this.setState({modalVisible:!1}),o.default.success(l?(0,C.formatMessage)({id:"msg.created"}):(0,C.formatMessage)({id:"msg.updated"}))}})}),this.handlePermissionModalVisiable=((e,t)=>{this.setState({assignUserId:e||"",permissionVisible:!this.state.permissionVisible},()=>{t&&t()})}),this.handleAssignPermissions=(e=>{var t=this.props.dispatch;t({type:"user/getPermission",payload:{id:e},callback:()=>{this.handlePermissionModalVisiable(e,()=>{var e=this.props.permission;this.child.setCheckedKeys(e.user.concat(e.role),e.role)})}})}),this.handleSavePermission=(e=>{var t=this.props.dispatch;t({type:"user/savePermission",payload:{id:this.state.assignUserId,resource_list:e},callback:()=>{o.default.success((0,C.formatMessage)({id:"msg.saved"})),this.handlePermissionModalVisiable()}})})}componentDidMount(){this.initRoleDropList()}render(){var e=this.props,t=e.data,a=e.roleList,l=e.loading,s=this.state.sortedInfo,o=[{title:(0,C.formatMessage)({id:"label.account"}),key:"user_name",dataIndex:"user_name",fixed:!0,width:200},{title:(0,C.formatMessage)({id:"label.name-cn"}),key:"name_cn",dataIndex:"name_cn",fixed:!0,width:120},{title:(0,C.formatMessage)({id:"label.name-en"}),key:"name_en",dataIndex:"name_en",width:180},{title:(0,C.formatMessage)({id:"label.status"}),key:"status",dataIndex:"status",sorter:!0,sortOrder:"status"===s.columnKey&&s.order,width:120,render:e=>w.default.createElement("span",null,0==e?w.default.createElement(n.default,{color:"green"},w.default.createElement(C.FormattedMessage,{id:"label.status.normal"})):1==e?w.default.createElement(n.default,{color:"red"},w.default.createElement(C.FormattedMessage,{id:"label.status.disabled"})):w.default.createElement(n.default,{color:"grey"},w.default.createElement(C.FormattedMessage,{id:"label.status.deleted"})))},{title:(0,C.formatMessage)({id:"label.mobile"}),key:"mobile",dataIndex:"mobile",width:180},{title:(0,C.formatMessage)({id:"label.role"}),key:"role",dataIndex:"role",width:200,render:e=>w.default.createElement("span",null,e.map(e=>w.default.createElement(n.default,{key:e.id},e.role_name)))},{title:(0,C.formatMessage)({id:"label.sex"}),key:"sex",dataIndex:"sex",sorter:!0,sortOrder:"sex"===s.columnKey&&s.order,width:120,render:e=>w.default.createElement("span",null,1==e?w.default.createElement(g.default,{type:"male",size:"lg",color:"#0082f3"}):w.default.createElement(g.default,{type:"female",size:"lg",color:"#f98c3d"}))},{title:(0,C.formatMessage)({id:"label.email"}),key:"mail",dataIndex:"mail",width:200},{title:(0,C.formatMessage)({id:"label.create-time"}),key:"create_time",dataIndex:"create_time",sorter:!0,sortOrder:"create_time"===s.columnKey&&s.order,width:200,render:e=>w.default.createElement("span",null,(0,P.formatTime)(e))},{title:(0,C.formatMessage)({id:"label.operation"}),key:"operation",fixed:"right",width:200,render:(e,t)=>w.default.createElement("div",null,2===t.status||t.is_system?null:w.default.createElement("span",null,w.default.createElement("a",{onClick:()=>this.handleAssignPermissions(t.id)},w.default.createElement(g.default,{type:"safety"})," ",w.default.createElement(C.FormattedMessage,{id:"label.permissions"})),w.default.createElement(r.default,{type:"vertical"}),w.default.createElement("a",{onClick:()=>this.handleEdit(t)},w.default.createElement(g.default,{type:"edit"})," ",w.default.createElement(C.FormattedMessage,{id:"label.edit"})),w.default.createElement(r.default,{type:"vertical"}),1==t.status?w.default.createElement("a",{onClick:()=>this.handleChangeState(t.id,t.status)},w.default.createElement(g.default,{type:"unlock"})," ",w.default.createElement(C.FormattedMessage,{id:"label.enable"})):w.default.createElement("a",{onClick:()=>this.handleChangeState(t.id,t.status)},w.default.createElement(g.default,{type:"lock"})," ",w.default.createElement(C.FormattedMessage,{id:"label.disable"})),w.default.createElement(r.default,{type:"vertical"}),w.default.createElement(i.default,{placement:"topRight",icon:w.default.createElement(g.default,{type:"question-circle",className:"danger"}),okText:(0,C.formatMessage)({id:"button.yes"}),cancelText:(0,C.formatMessage)({id:"button.no"}),title:(0,C.formatMessage)({id:"system.user.delete.prompt"}),onConfirm:()=>this.handleDelete(t.id)},w.default.createElement("a",null,w.default.createElement(g.default,{type:"delete"})," ",w.default.createElement(C.FormattedMessage,{id:"label.delete"})))))}],u=w.default.createElement(w.default.Fragment,null,w.default.createElement(d.default,{type:"primary",onClick:()=>this.handleModalOpen(!0)},w.default.createElement(g.default,{type:"plus",style:{marginRight:"6px"}}),w.default.createElement(C.FormattedMessage,{id:"button.add"}))),m={mode:this.state.modalMode,editInfo:this.state.editInfo,roleList:a,modalVisible:this.state.modalVisible,handleModalVisible:this.handleModalVisible,handleSave:this.handleSave};return w.default.createElement(w.Fragment,null,w.default.createElement(F.default,{loading:l,url:"user/getList",data:t,columns:o,buttons:u,rowKey:"id",onChange:this.handleChange},w.default.createElement(F.default.QueryItem,{label:(0,C.formatMessage)({id:"system.user"}),name:"user_name"},w.default.createElement(p.default,{placeholder:(0,C.formatMessage)({id:"system.user.placeholder.user"})})),w.default.createElement(F.default.QueryItem,{label:w.default.createElement(C.FormattedMessage,{id:"label.status"}),name:"status"},w.default.createElement(f.default,{placeholder:w.default.createElement(C.FormattedMessage,{id:"placeholder.select"}),allowClear:!0},w.default.createElement(f.default.Option,{value:"0"},w.default.createElement(C.FormattedMessage,{id:"label.status.normal"})),w.default.createElement(f.default.Option,{value:"1"},w.default.createElement(C.FormattedMessage,{id:"label.status.disabled"})),w.default.createElement(f.default.Option,{value:"2"},w.default.createElement(C.FormattedMessage,{id:"label.status.deleted"}))))),w.default.createElement(L,m),w.default.createElement(q.default,{modalVisible:this.state.permissionVisible,handleModalVisible:this.handlePermissionModalVisiable,triggerRef:this.bindRef,handleSave:this.handleSavePermission}))}},k=V))||k),A=R;t.default=A}}]);